{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> {% block title %}CIT 306 GP 14{% endblock %}</title>
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <link rel="stylesheet" href="{% static 'css/footer.css' %}">
  <link rel="stylesheet" href="{% static 'css/header.css' %}">
  <link rel="stylesheet" href="{% static 'css/loader.css' %}">
  
  {% block head %}{% endblock %}
  {% block extra_css %}{% endblock %}
  <style>
    /* minimal overlay styles (won't interfere with your existing .loader5) */
    #global-page-loader { 
      display: none; 
      position: fixed; 
      inset: 0; 
      z-index: 9999; 
      align-items: center; 
      justify-content: center; 
      background: rgba(109, 109, 109, 0.39); }
    #global-page-loader.show { 
      display: flex; 
      pointer-events: auto; }

    
    .loader5 {
      position: relative;
      width: 80px;
      height: 80px;
    }

    .loader5 span {
      position: absolute;
      border: 3px solid #1e613c;
      opacity: 1;
      border-radius: 50%;
      animation: loader5-animation 1.2s cubic-bezier(0, 0.2, 0.8, 1) infinite;
    }

    .loader5 span:nth-child(2) {
      animation-delay: -0.5s;
    }

    @keyframes loader5-animation {
      0% {
        top: 36px;
        left: 36px;
        width: 0;
        height: 0;
        opacity: 0;
      }

      4.9% {
        top: 36px;
        left: 36px;
        width: 0;
        height: 0;
        opacity: 0;
      }

      5% {
        top: 36px;
        left: 36px;
        width: 0;
        height: 0;
        opacity: 1;
      }

      100% {
        top: 0px;
        left: 0px;
        width: 72px;
        height: 72px;
        opacity: 0;
      }
    }

  </style>
  
  
  
</head>
<body>
  <!-- Spinner overlay (hidden by default). Place in base.html -->
  <div id="global-page-loader" aria-hidden="true">
    <div class="loader5" role="status" aria-label="Loading">
      <span></span><span></span>
    </div>
  </div>

  <header class="site-header">
  <div class="container">
    <div class="logo">CIT 306 GP 14</div>

    <!-- Hamburger button -->
    <button class="nav-toggle" aria-controls="mobile-menu" aria-expanded="false">
      â˜°
    </button>

    <!-- Collapsible mobile menu -->
    <div id="mobile-menu" class="nav-menu">
      <ul class="menu">
        <li><a href="{% url 'core:home' %}">Home</a></li>
        <li class="dropdown">
          <button class="dropdown-toggle">Core Important</button>
          <ul class="submenu">
            <li><a href="{% url 'board:announcements' %}">Announcements</a></li>
            <li><a href="{% url 'board:events' %}">Events</a></li>
            <li><a href="{% url 'board:timetable' %}">Timetable</a></li>
            <li><a href="{% url 'board:results' %}">Results</a></li>
          </ul>
        </li>
        <li><a href="{% url 'team:credentials' %}">Group Members</a></li>
        <li><a href="{% url 'core:about' %}">About</a></li>
        <li><a href="{% url 'core:contact' %}">Contact</a></li>
        <div class="auth-links">
          {% if user.is_authenticated %}
            <a href="{% url 'accounts:profile' %}" style="font-size: 18px; text-decoration: none;">ðŸ‘¤</a>
            <a href="{% url 'accounts:logout' %}" style="font-size: 18px; text-decoration: none;">ðŸ”’</a>
          {% else %}
            <a href="{% url 'accounts:login' %}" style="text-decoration: none; color: black; font-size: 18px;">Login</a>
          {% endif %}
        </div>
      </ul>

      
    </div>
  </div>
</header>


  <main class="container">
    {% block content %}{% endblock %}
  </main>

    <footer class="site-footer" role="contentinfo">
    <div class="container" >
      <div class="footer-grid" aria-label="Footer links">
        <!-- Column 1: About -->
        <div class="footer-col footer-about">
          <h4 class="footer-title">About</h4>
          <p>Departmental Student Information Board - CIT 306 GROUP 14.  
             A simple noticeboard for announcements, events, timetables and results.</p>
        </div>

        <!-- Column 2: Quick links -->
        <div class="footer-col footer-links">
          <h4 class="footer-title">Quick links</h4>
          <ul>
            <li><a href="{% url 'core:home' %}">Home</a></li>
            <li><a href="{% url 'board:announcements' %}">Announcements</a></li>
            <li><a href="{% url 'board:events' %}">Events</a></li>
            <li><a href="{% url 'board:timetable' %}">Timetable</a></li>
            <li><a href="{% url 'board:results' %}">Results</a></li>
          </ul>
        </div>

        <!-- Column 3: Resources -->
        <div class="footer-col footer-resources">
          <h4 class="footer-title">Resources</h4>
          <ul>
            <li><a href="{% url 'board:archive' %}">Archive</a></li>
            <li><a href="{% url 'board:search' %}">Search</a></li>
            <li><a href="{% url 'core:about' %}">About Dept.</a></li>
            <li><a href="{% url 'core:contact' %}">Contact</a></li>
          </ul>
        </div>

        <!-- Column 4: Contact -->
        <div class="footer-col footer-contact">
          <h4 class="footer-title">Contact</h4>
          <address>
            <p>Departmental Student Information Board</p>
            <p><a href="mailto:cit306group14@gmail.com">cit306group14@gmail.com</a></p>
            <p>Project: CIT 306 GROUP 14 Web Development</p>
          </address>
        </div>
      </div>

      <!-- Bottom row -->
      <div class="footer-bottom">
        <p>Departmental Student Information Board CIT 306 GROUP 14</p>
        <p style="padding: 1rem;">Group Contact Email: <a href="mailto:cit306group14@gmail.com">cit306group14@gmail.com</a></p>
      </div>
    </div>
  </footer>
  <!-- <script src="{% static 'js/loader.js' %}"></script> -->
  <script>
  const toggleBtn = document.querySelector('.nav-toggle');
  const navMenu = document.querySelector('#mobile-menu');

  toggleBtn.addEventListener('click', () => {
    const expanded = toggleBtn.getAttribute('aria-expanded') === 'true';
    toggleBtn.setAttribute('aria-expanded', !expanded);
    navMenu.classList.toggle('active');
  });

  // the loader scripts
  
(function () {
    const loader = document.getElementById('global-page-loader');
    function showLoader() {
      if (!loader) return;
      loader.classList.add('show');
      loader.setAttribute('aria-hidden', 'false');
    }
    function hideLoader() {
      if (!loader) return;
      loader.classList.remove('show');
      loader.setAttribute('aria-hidden', 'true');
    }

    // helper to test internal link
    function isInternalLink(a) {
      if (!a || !a.getAttribute) return false;
      const href = a.getAttribute('href') || '';
      if (!href || href.startsWith('#') || href.startsWith('mailto:') || href.startsWith('tel:')) return false;
      if (a.target === '_blank' || a.hasAttribute('download') || a.dataset.noSpinner !== undefined) return false;
      try {
        const url = new URL(href, location.href);
        return url.origin === location.origin;
      } catch (e) {
        return true; // relative link
      }
    }

    document.addEventListener('click', function (e) {
      const a = e.target.closest && e.target.closest('a');
      if (!a) return;
      if (!isInternalLink(a)) return;
      const href = a.getAttribute('href') || '';
      if (href.startsWith('#') && href.length > 1) return;
      showLoader();
    }, { capture: true });

    document.addEventListener('submit', function (e) {
      const form = e.target;
      if (!form || form.dataset.noSpinner !== undefined) return;
      showLoader();
    }, { capture: true });

    window.addEventListener('beforeunload', function () { showLoader(); });
    window.addEventListener('pageshow', function () { hideLoader(); });

    // wrap fetch and XHR
    (function wrapNetwork() {
      let activeRequests = 0;
      const originalFetch = window.fetch;
      if (originalFetch) {
        window.fetch = function (...args) {
          activeRequests++;
          showLoader();
          return originalFetch.apply(this, args)
            .then(resp => {
              activeRequests = Math.max(0, activeRequests - 1);
              if (activeRequests === 0) hideLoader();
              return resp;
            })
            .catch(err => {
              activeRequests = Math.max(0, activeRequests - 1);
              if (activeRequests === 0) hideLoader();
              throw err;
            });
        };
      }

      const XHR = window.XMLHttpRequest;
      if (XHR) {
        const origOpen = XHR.prototype.open;
        const origSend = XHR.prototype.send;
        XHR.prototype.open = function () {
          this._shouldTrack = true;
          return origOpen.apply(this, arguments);
        };
        XHR.prototype.send = function () {
          if (this._shouldTrack) {
            activeRequests++;
            showLoader();
            this.addEventListener('readystatechange', function () {
              if (this.readyState === 4) {
                activeRequests = Math.max(0, activeRequests - 1);
                if (activeRequests === 0) hideLoader();
              }
            });
          }
          return origSend.apply(this, arguments);
        };
      }
    })();

    // safety timeout
    const SAFETY_TIMEOUT = 15000;
    let safetyTimer = null;
    function startSafety() { clearTimeout(safetyTimer); safetyTimer = setTimeout(hideLoader, SAFETY_TIMEOUT); }
    function clearSafety() { clearTimeout(safetyTimer); }

    const _show = showLoader; const _hide = hideLoader;
    window.showPageLoader = function () { _show(); startSafety(); };
    window.hidePageLoader = function () { _hide(); clearSafety(); };

    document.addEventListener('DOMContentLoaded', hideLoader);
  })();

</script>
{% block extra_scripts %}{% endblock %}
</body>
</html>
